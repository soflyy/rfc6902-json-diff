'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var k = require('fast-array-diff/dist/diff/lcs');
var C = require('fast-deep-equal');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var k__default = /*#__PURE__*/_interopDefaultLegacy(k);
var C__default = /*#__PURE__*/_interopDefaultLegacy(C);

var w={};function v(o,e,n,r="",p=[]){let t=Object.keys(o),a=Object.keys(e);if(t.length===0&&a.length===0)return p;for(let d=t.length-1;d>=0;d--){let i=t[d];m(o[i],e[i],n,`${r}/${i}`,i in e,p);}for(let d=0;d<a.length;d++){let i=a[d];!(i in o)&&e[i]!==void 0&&p.push({op:"add",path:`${r}/${i}`,value:e[i]});}return p}var x=o=>{};function b(o,e,n,r="",p=[],t=!1){return g(o,e,n,r,p,t)}function F(o,e,n,r){let p=[];for(let t of o)if(t.type==="remove"){let a=e.slice(t.oldStart,t.oldEnd),d={startIdx:t.oldStart,length:a.length,lengthShift:0};for(let[i,u]of a.entries()){let s=t.oldStart+i,c=s+r.additionsIdxShift-r.removalsIdxShift+i;p.push({type:"remove",value:u,sourceArrayRemovalBatch:d,sourceArrayRemovalBatchPosition:i,sourceArrayIdx:s,totalShiftedIdx:c}),r.removalsIdxShift++;}}else if(t.type==="add"){let a=n.slice(t.newStart,t.newEnd),d={startIdx:t.oldStart,length:a.length};for(let[i,u]of a.entries()){let s=t.newStart+i,c=t.oldStart+i,l=c+r.additionsIdxShift-r.removalsIdxShift-i;p.push({type:"add",value:u,targetArrayIdx:s,sourceArrayAdditionBatch:d,sourceArrayAdditionBatchPosition:i,sourceArrayIdx:c,totalShiftedIdx:l}),r.additionsIdxShift++;}}return p}function T(o,e,n,r,p,t){for(let a of o)if(a.type==="remove"){let d=a.totalShiftedIdx-a.sourceArrayRemovalBatchPosition-a.sourceArrayRemovalBatch.lengthShift;e.push({op:"remove",path:`${n}/${d}`});}else a.type==="add"?e.push({op:"add",path:`${n}/${a.totalShiftedIdx}`,value:a.value}):a.type==="move"?e.push({op:"move",path:`${n}/${a.toShiftedIdx}`,from:`${n}/${a.fromShiftedIdx}`}):a.type==="replace"&&m(p[a.shiftedIdx],a.value,r,`${n}/${a.shiftedIdx}`,!0,e,t);}function g(o,e,n,r,p=[],t=!1){let a=-1,d=[],i=[],u=[],s={additionsIdxShift:0,removalsIdxShift:0};function c(l,L,R,I,j,A,S){let h=Object.freeze({type:l,oldStart:R,oldEnd:I,newStart:A,newEnd:S});if(l==="same"){a++;let y=[...u,...i];if(y.length===0)return;let f=F(y,o,e,s);u.length!==0&&i.length!==0&&(B(f),x()),d.push(...f),i.splice(0),u.splice(0);}else l==="add"?i.push(h):l==="remove"&&u.push(h);}return k__default["default"](o,e,n,c),c("same",[],0,0,[],0,0),a<=0?(p.push({op:"replace",path:r,value:e}),p):(T(d,p,r,n,o,t),p)}function B(o){for(let e=o.length-1;e>=0;e--)if(!(o[e].type!=="add"&&o[e].type!=="remove"))for(let n=e-1;n>=0;n--){if(o[n].type===o[e].type||o[n].type!=="add"&&o[n].type!=="remove")continue;let r=o[e].type==="add"?o[e]:o[n],p=o[e].type==="remove"?o[e]:o[n];if(r.targetArrayIdx===p.sourceArrayIdx){p.sourceArrayRemovalBatch.lengthShift--,o[n]={type:"replace",value:r.value,removedValue:p.value,shiftedIdx:p.sourceArrayIdx},o.splice(e,1);break}}}function O(o,e,n,r="",p=[],t=!1){let a=o.length,d=e.length;return a===0&&d===0?p:a===0?(p.push({op:"add",path:r,value:e}),p):d===0?(p.push({op:"replace",path:r,value:e}),p):a===1&&d===1?m(o[0],e[0],n,`${r}/0`,!0,p):b(o,e,n,r,p,t)}function m(o,e,n,r="",p=!1,t=[],a=!1){if(Object.is(o,e))return t;if(!p&&o!==void 0&&e===void 0)return t.push({op:"remove",path:r}),t;let d=o===null?"null":typeof o,i=e===null?"null":typeof e,u=d==="object"&&Array.isArray(o),s=i==="object"&&Array.isArray(e);return d!==i||u!==s?(t.push({op:"replace",path:r,value:e}),t):u&&s?(O(o,e,n,r,t,a),t):d==="object"?(v(o,e,n,r,t),t):(t.push({op:"replace",path:r,value:e}),t)}function $(o){if(!o)return C__default["default"];let e=new WeakMap;return (n,r)=>{var p,t,a,d;if(typeof n=="object"&&n!==null&&typeof r=="object"&&r!==null){if(e.has(n)&&((p=e.get(n))==null?void 0:p.includes(r))||e.has(r)&&((t=e.get(r))==null?void 0:t.includes(n)))return !0;let i=C__default["default"](n,r);return i&&(e.has(n)?(a=e.get(n))==null||a.push(r):e.set(n,[r]),e.has(r)?(d=e.get(r))==null||d.push(n):e.set(r,[n])),i}else return C__default["default"](n,r)}}function N(o,e,n={}){let r=$(Boolean(n.doCaching));return m(o,e,r,"",!1,[],Boolean(n.detectMoveOperations))}

exports.RFC6902 = w;
exports.compare = N;
exports.diffArrays = O;
exports.diffArraysUsingLcs = b;
exports.diffObjects = v;
exports.diffUnknownValues = m;
exports.getLcsBasedOperations = g;
