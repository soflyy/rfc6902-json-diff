'use strict';

var B={};function $(n,e,o,r="",a=[]){let i;for(i in n)k(n[i],e[i],o,`${r}/${i}`,i in e,a);for(i in e)!(i in n)&&e[i]!==void 0&&a.push({op:"add",path:`${r}/${i}`,value:e[i]});}function P(n,e){let{b:o,eq:r,stack_base:a}=n,{i,N:t,j:u,M:p,Z:s,stack_top:l}=n;for(;;){if(e===0){e:for(;t>0&&p>0;){o.fill(0,0,2*s);let x=t-p,h=t+p,f=h&1,O=i+t-1,w=u+p-1,F=(h+f)/2,b;n:for(let m=0;m<=F;m++){let A=2*Math.max(0,m-p)-m,y=m-2*Math.max(0,m-t);for(let c=A;c<=y;c+=2){let T=o[c-1-s*Math.floor((c-1)/s)],S=o[c+1-s*Math.floor((c+1)/s)],v=c===-m||c!==m&&T<S?S:T+1,I=v-c,d=v,C=I;for(;d<t&&C<p&&r(i+d,u+C);)d++,C++;if(o[c-s*Math.floor(c/s)]=d,f===1&&(b=x-c)>=1-m&&b<m&&d+o[s+b-s*Math.floor(b/s)]>=t)if(m>1||d!==v){a[l++]=i+d,a[l++]=t-d,a[l++]=u+C,a[l++]=p-C,t=v,p=I,s=2*(Math.min(t,p)+1);continue e}else break n}for(let c=A;c<=y;c+=2){let T=o[s+c-1-s*Math.floor((c-1)/s)],S=o[s+c+1-s*Math.floor((c+1)/s)],v=c===-m||c!==m&&T<S?S:T+1,I=v-c,d=v,C=I;for(;d<t&&C<p&&r(O-d,w-C);)d++,C++;if(o[s+c-s*Math.floor(c/s)]=d,f===0&&(b=x-c)>=-m&&b<=m&&d+o[b-s*Math.floor(b/s)]>=t)if(m>0||d!==v){a[l++]=i+t-v,a[l++]=v,a[l++]=u+p-I,a[l++]=I,t=t-d,p=p-C,s=2*(Math.min(t,p)+1);continue e}else break n}}if(t!==p){p>t?(i+=t,u+=t,p-=t,t=0):(i+=p,u+=p,t-=p,p=0);break}}if(t+p!==0)if(n.pxe===i||n.pye===u)n.pxe=i+t,n.pye=u+p;else {let x=n.pxs;if(n.oxs=n.pxs,n.oxe=n.pxe,n.oys=n.pys,n.oye=n.pye,n.pxs=i,n.pxe=i+t,n.pys=u,n.pye=u+p,x>=0)return n.i=i,n.N=t,n.j=u,n.M=p,n.Z=s,n.stack_top=l,1}}if(e===0||e===1){if(l===0)return 2;p=a[--l],u=a[--l],t=a[--l],i=a[--l],s=2*(Math.min(t,p)+1),e=0;}}}var M=class{constructor(e){this.state=e;this.c=0;}[Symbol.iterator](){return this}next(){let{state:e}=this;if(this.c>1)return {done:!0,value:void 0};let o=P(e,this.c);return this.c=o,o===1?{done:!1,value:[e.oxs,e.oxe,e.oys,e.oye]}:e.pxs>=0?{done:!1,value:[e.pxs,e.pxe,e.pys,e.pye]}:{done:!0,value:void 0}}};function E(n,e,o,r,a){let i=(Math.min(e,r)+1)*2,t=e+r,u=new(t<256?Uint8Array:t<65536?Uint16Array:Uint32Array)(2*i);return new M({i:n,N:e,j:o,M:r,Z:i,b:u,eq:a,pxs:-1,pxe:-1,pys:-1,pye:-1,oxs:-1,oxe:-1,oys:-1,oye:-1,stack_top:0,stack_base:[]})}function L(n,e,o){let[r,a,i]=[0,n.length,e.length],t=o!=null?o:(u,p)=>n[u]===e[p];for(;r<a&&r<i&&t(r,r);)r++;if(r===a&&r===i)return [][Symbol.iterator]();for(;t(--a,--i)&&a>r&&i>r;);return E(r,a+1-r,r,i+1-r,t)}function*U(n,e,o){let r=ArrayBuffer.isView(n)?Uint8Array.prototype.subarray:n.slice;for(let a of L(n,e,o))a[2]=r.call(e,a[2],a[3]),yield a;}function j(n,e,o,r="",a=[],i=!1){let t=[],u=U(n,e,(h,f)=>o(n[h],e[f])),p=0,s=0,l=0,x=0;for(let h of u){let[f,O]=h,[,,w]=h,F=f;f+=s-p,O+=s-p,x!==f&&(l+=f-x),x=O;let b=0,m=0,A=0;for(let y=0,c=f;c<O;y++,c++)w[y]===void 0?(t.push({type:"remove",shiftedIdx:c,sourceArrayRemovalBatchStartIdx:F,sourceArrayRemovalBatchPosition:m}),m++):(t.push({type:"replace",value:w[y],shiftedIdx:c,removedValue:n[F+y]}),A++);for(let y=A;y<w.length;y++)t.push({type:"add",value:w[y],totalShiftedIdx:f+y}),b++;s+=b,p+=m;}if(x<n.length&&(l+=n.length-x),l<1){a.push({op:"replace",path:r,value:e});return}i&&N(t,o,n),D(t,a,r,o,i);}function D(n,e,o,r,a){for(let i of n)switch(i.type){case"add":{e.push({op:"add",path:`${o}/${i.totalShiftedIdx}`,value:i.value});break}case"remove":{let t=i.shiftedIdx-i.sourceArrayRemovalBatchPosition;e.push({op:"remove",path:`${o}/${t}`});break}case"replace":{k(i.removedValue,i.value,r,`${o}/${i.shiftedIdx}`,!0,e,a);break}case"move":{e.push({op:"move",path:`${o}/${i.toShiftedIdx}`,from:`${o}/${i.fromShiftedIdx}`});break}}}function N(n,e,o){for(let r=n.length-1;r>=0;r--){let a=n[r];if(a.type!=="add"&&a.type!=="remove")continue;let i=a.type==="add"?a.value:o[a.sourceArrayRemovalBatchStartIdx+a.sourceArrayRemovalBatchPosition];for(let t=r-1;t>=0;t--){let u=n[t];if(u.type===a.type||u.type!=="add"&&u.type!=="remove")continue;let p=u.type==="add"?u.value:o[u.sourceArrayRemovalBatchStartIdx+u.sourceArrayRemovalBatchPosition];if(!e(i,p))continue;let s=a.type==="add"?a:u,l=a.type==="remove"?a:u;n[t]={type:"move",fromShiftedIdx:l.shiftedIdx,toShiftedIdx:s.totalShiftedIdx,value:s.value},n.splice(r,1);break}}}function g(n,e,o,r="",a=[],i=!1){let t=n.length,u=e.length;if(t===0)for(let p=0;p<u;p++)a.push({op:"add",path:`${r}/${p}`,value:e[p]});else u===0?a.push({op:"replace",path:r,value:e}):t===1&&u===1?k(n[0],e[0],o,`${r}/0`,!0,a):j(n,e,o,r,a,i);}function k(n,e,o,r="",a=!1,i=[],t=!1){if(n===e)return;if(!a&&n!==void 0&&e===void 0){i.push({op:"remove",path:r});return}let u;if(n&&e&&(u=n.constructor)===e.constructor){if(u===Array){g(n,e,o,r,i,t);return}if(!u||typeof n=="object"){$(n,e,o,r,i);return}}i.push({op:"replace",path:r,value:e});}var _=Object.prototype.hasOwnProperty;function R(n,e){if(n===e)return !0;let o,r;if(n&&e&&(o=n.constructor)===e.constructor){if(o===Date)return n.getTime()===e.getTime();if(o===RegExp)return n.toString()===e.toString();if(o===Array){if((r=n.length)===e.length)for(;r--&&R(n[r],e[r]););return r===-1}if(!o||typeof n=="object"){r=0;for(o in n)if(_.call(n,o)&&++r&&!_.call(e,o)||!(o in e)||!R(n[o],e[o]))return !1;return Object.keys(e).length===r}}return n!==n&&e!==e}function Z(n){if(!n)return R;let e=new WeakMap;return (o,r)=>{var a,i,t,u;if(typeof o=="object"&&o!==null&&typeof r=="object"&&r!==null){if(e.has(o)&&((a=e.get(o))==null?void 0:a.includes(r))||e.has(r)&&((i=e.get(r))==null?void 0:i.includes(o)))return !0;let p=R(o,r);return p&&(e.has(o)?(t=e.get(o))==null||t.push(r):e.set(o,[r]),e.has(r)?(u=e.get(r))==null||u.push(o):e.set(r,[o])),p}else return R(o,r)}}function ie(n,e,o={}){let r=Z(Boolean(o.doCaching)),a=[];return k(n,e,r,"",!1,a,Boolean(o.detectMoveOperations)),a}

exports.RFC6902 = B;
exports.compare = ie;
exports.diffArrays = g;
exports.diffArraysUsingLcs = j;
exports.diffObjects = $;
exports.diffUnknownValues = k;
