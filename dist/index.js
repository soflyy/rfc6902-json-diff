'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var g = require('fast-array-diff/dist/diff/lcs');
var C = require('fast-deep-equal');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var g__default = /*#__PURE__*/_interopDefaultLegacy(g);
var C__default = /*#__PURE__*/_interopDefaultLegacy(C);

var R={};function x(n,e,o,t="",d=[]){let r=Object.keys(n),a=Object.keys(e);if(r.length===0&&a.length===0)return d;for(let p=r.length-1;p>=0;p--){let i=r[p];c(n[i],e[i],o,`${t}/${i}`,i in e,d);}for(let p=0;p<a.length;p++){let i=a[p];!(i in n)&&e[i]!==void 0&&d.push({op:"add",path:`${t}/${i}`,value:e[i]});}return d}function v(n,e,o,t="",d=[],r=!1){return k(n,e,o,t,d,r)}function w(n,e,o,t){let d=[];for(let r of n)if(r.type==="remove"){let a=e.slice(r.oldStart,r.oldEnd),p={startIdx:r.oldStart,length:a.length,lengthShift:0};for(let[i,s]of a.entries()){let u=r.newStart+i,m=r.oldStart+i,l=m+t.additionsIdxShift-t.removalsIdxShift+i;d.push({type:"remove",value:s,targetArrayIdx:u,sourceArrayRemovalBatch:p,sourceArrayRemovalBatchPosition:i,sourceArrayIdx:m,totalShiftedIdx:l,indexShifts:{...t}}),t.removalsIdxShift++;}}else if(r.type==="add"){let a=o.slice(r.newStart,r.newEnd),p={startIdx:r.oldStart,length:a.length};for(let[i,s]of a.entries()){let u=r.newStart+i,m=r.oldStart+i,l=m+t.additionsIdxShift-t.removalsIdxShift-i;d.push({type:"add",value:s,targetArrayIdx:u,sourceArrayAdditionBatch:p,sourceArrayAdditionBatchPosition:i,sourceArrayIdx:m,totalShiftedIdx:l,indexShifts:{...t}}),t.additionsIdxShift++;}}return d}function T(n,e,o,t,d,r){for(let a of n)if(a.type==="remove"){let p=a.totalShiftedIdx-a.sourceArrayRemovalBatchPosition-a.sourceArrayRemovalBatch.lengthShift;e.push({op:"remove",path:`${o}/${p}`});}else a.type==="add"?e.push({op:"add",path:`${o}/${a.totalShiftedIdx}`,value:a.value}):a.type==="move"?e.push({op:"move",path:`${o}/${a.toShiftedIdx}`,from:`${o}/${a.fromShiftedIdx}`}):a.type==="replace"&&c(d[a.shiftedIdx],a.value,t,`${o}/${a.shiftedIdx}`,!0,e,r);}function k(n,e,o,t,d=[],r=!1){let a=-1,p=[],i=[],s=[],u={additionsIdxShift:0,removalsIdxShift:0};function m(l,L,I,b,E,O,A){let f={type:l,oldStart:I,oldEnd:b,newStart:O,newEnd:A};if(l==="same"){a+=1+(f.oldEnd-f.oldStart);let y=[...s,...i];if(y.length===0)return;let h=w(y,n,e,u);F(h),p.push(...h),i.splice(0),s.splice(0);}else if(l==="add")i.push(f);else if(l==="remove"){if(i.length>0){for(let y of i)y.oldStart+=f.oldEnd-f.oldStart;f.newStart-=f.oldEnd-f.oldStart;}s.push(f);}}return g__default["default"](n,e,o,m),m("same",[],0,0,[],0,0),a<=0?(d.push({op:"replace",path:t,value:e}),d):(r&&B(p,o),T(p,d,t,o,n,r),d)}function F(n){for(let e=n.length-1;e>=0;e--)if(!(n[e].type!=="add"&&n[e].type!=="remove"))for(let o=e-1;o>=0;o--){if(n[o].type===n[e].type||n[o].type!=="add"&&n[o].type!=="remove")continue;let t=n[e].type==="add"?n[e]:n[o],d=n[e].type==="remove"?n[e]:n[o];if(t.targetArrayIdx===d.sourceArrayIdx){d.sourceArrayRemovalBatch.lengthShift--,n[o]={type:"replace",value:t.value,removedValue:d.value,shiftedIdx:d.sourceArrayIdx},n.splice(e,1);break}}}function B(n,e){for(let o=n.length-1;o>=0;o--){let t=n[o];if(t.type!=="add"&&t.type!=="remove")continue;let d=t.indexShifts.additionsIdxShift-t.indexShifts.removalsIdxShift;for(let r=o-1;r>=0;r--){let a=n[r];if(a.type===t.type||a.type!=="add"&&a.type!=="remove"||!e(t.value,a.value))continue;let p=t.type==="add"?t:a,i=t.type==="remove"?t:a,s=a.indexShifts.additionsIdxShift-a.indexShifts.removalsIdxShift,u=d-s;n[r]={type:"move",fromShiftedIdx:i.totalShiftedIdx>p.totalShiftedIdx?i.totalShiftedIdx-u:i.totalShiftedIdx,toShiftedIdx:p.totalShiftedIdx,value:p.value},n.splice(o,1);break}}}function S(n,e,o,t="",d=[],r=!1){let a=n.length,p=e.length;return a===0&&p===0?d:a===0?(d.push({op:"add",path:t,value:e}),d):p===0?(d.push({op:"replace",path:t,value:e}),d):a===1&&p===1?c(n[0],e[0],o,`${t}/0`,!0,d):v(n,e,o,t,d,r)}function c(n,e,o,t="",d=!1,r=[],a=!1){if(Object.is(n,e))return r;if(!d&&n!==void 0&&e===void 0)return r.push({op:"remove",path:t}),r;let p=n===null?"null":typeof n,i=e===null?"null":typeof e,s=p==="object"&&Array.isArray(n),u=i==="object"&&Array.isArray(e);return p!==i||s!==u?(r.push({op:"replace",path:t,value:e}),r):s&&u?(S(n,e,o,t,r,a),r):p==="object"?(x(n,e,o,t,r),r):(r.push({op:"replace",path:t,value:e}),r)}function $(n){if(!n)return C__default["default"];let e=new WeakMap;return (o,t)=>{var d,r,a,p;if(typeof o=="object"&&o!==null&&typeof t=="object"&&t!==null){if(e.has(o)&&((d=e.get(o))==null?void 0:d.includes(t))||e.has(t)&&((r=e.get(t))==null?void 0:r.includes(o)))return !0;let i=C__default["default"](o,t);return i&&(e.has(o)?(a=e.get(o))==null||a.push(t):e.set(o,[t]),e.has(t)?(p=e.get(t))==null||p.push(o):e.set(t,[o])),i}else return C__default["default"](o,t)}}function Q(n,e,o={}){let t=$(Boolean(o.doCaching));return c(n,e,t,"",!1,[],Boolean(o.detectMoveOperations))}

exports.RFC6902 = R;
exports.compare = Q;
exports.diffArrays = S;
exports.diffArraysUsingLcs = v;
exports.diffObjects = x;
exports.diffUnknownValues = c;
exports.getLcsBasedOperations = k;
